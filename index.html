<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inversiones Mart√≠n - Full Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1000px; margin: auto; }
        .header { background: #2c3e50; color: white; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 25px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #95a5a6; font-size: 11px; text-transform: uppercase; padding: 10px; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100px; }
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #3498db; color: white; margin-left: 10px; }
        .btn-del { background: #e74c3c; color: white; font-size: 10px; padding: 5px; }
        .subtotal { font-weight: bold; color: #27ae60; text-align: right; }
        .section-total { text-align: right; font-weight: bold; font-size: 1.2em; margin-top: 15px; border-top: 2px solid #eee; padding-top: 10px; }
        .loading-text { font-size: 0.8em; color: #f39c12; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <small>PATRIMONIO TOTAL CONSOLIDADO</small>
        <h1 id="total-general">$0,00</h1>
    </div>

    <div class="card">
        <h2>üìà Acciones & Cripto (Yahoo Finance)</h2>
        <div style="margin-bottom: 15px;">
            <input type="text" id="new-tk" placeholder="Ticker (AAPL)">
            <input type="number" id="new-qty" placeholder="Cantidad">
            <button class="btn btn-add" onclick="addStock()">+ Agregar</button>
        </div>
        <table>
            <thead>
                <tr><th>Ticker</th><th>Cantidad</th><th>Precio</th><th style="text-align: right;">Subtotal</th><th></th></tr>
            </thead>
            <tbody id="stocks-body"></tbody>
        </table>
        <div class="section-total" id="sub-stocks">Subtotal Acciones: $0,00</div>
    </div>

    <div class="card" style="border-left: 5px solid #e67e22;">
        <h2>üè¶ Mutual Funds - Mart√≠n</h2>
        <table>
            <thead>
                <tr><th>Fondo / C√≥digo</th><th>Cantidad</th><th>NAV (Precio)</th><th style="text-align: right;">Subtotal</th></tr>
            </thead>
            <tbody id="martin-body"></tbody>
        </table>
        <div class="section-total" id="sub-martin">Subtotal Mart√≠n: $0,00</div>
    </div>

    <div class="card" style="border-left: 5px solid #3498db;">
        <h2>üè¶ Mutual Funds - Jorge</h2>
        <table>
            <thead>
                <tr><th>Fondo / C√≥digo</th><th>Cantidad</th><th>NAV (Precio)</th><th style="text-align: right;">Subtotal</th></tr>
            </thead>
            <tbody id="jorge-body"></tbody>
        </table>
        <div class="section-total" id="sub-jorge">Subtotal Jorge: $0,00</div>
    </div>
</div>

<script>
    // 1. DATA DE MART√çN
    const martinData = [
        {n:"Fed. Hermes", c:"FORS", q:4713.21, p:1.00},
        {n:"Lord Abbett", c:"G5648E661", q:2582.186, p:12.57},
        {n:"Janus Henderson", c:"G5S1BZ639", q:1727.545, p:20.80},
        {n:"Pimco Global", c:"G70974491", q:808.112, p:32.15},
        {n:"Thornburg Global", c:"G8T49N198", q:1157.025, p:36.41},
        {n:"Allianz Income", c:"L016D6246", q:1421.231, p:17.6878},
        {n:"Ab Sicav I", c:"L0173W230", q:620.444, p:68.29},
        {n:"Franklin U.S. Opp", c:"L4058Y329", q:357.654, p:55.32},
        {n:"Franklin Global Conv", c:"L40598481", q:2128.218, p:18.13},
        {n:"MFS Meridian Prudent", c:"L6366X224", q:3353.097, p:14.69},
        {n:"Morgan Stanley Global", c:"L65228550", q:131.543, p:149.63}
    ];

    // 2. DATA DE JORGE
    const jorgeData = [
        {n:"Federated Hermes", c:"FORS", q:3819.89, p:1.00},
        {n:"Janus Henderson", c:"G5S1BZ639", q:5034.388, p:20.80},
        {n:"Allianz Income", c:"L016D6246", q:6315.422, p:17.68},
        {n:"Franklin Global", c:"L40598481", q:7418.468, p:18.13},
        {n:"MFS Meridian", c:"L6366X224", q:9179.767, p:14.69},
        {n:"Morgan Stanley", c:"L65228550", q:267.019, p:149.63}
    ];

    let myStocks = JSON.parse(localStorage.getItem('myStocks')) || [
        {ticker:'ASTS', qty:100}, {ticker:'IREN', qty:50}, {ticker:'PLTR', qty:30}
    ];
    let stockPrices = {};

    const fmt = (v) => v.toLocaleString('es-AR', {minimumFractionDigits:2, maximumFractionDigits:2});

    async function getPrice(ticker) {
        try {
            const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/' + ticker)}`);
            const json = await res.json();
            const data = JSON.parse(json.contents);
            return data.chart.result[0].meta.regularMarketPrice || 0;
        } catch (e) { return 0; }
    }

    async function updateStockPrices() {
        for (let s of myStocks) {
            stockPrices[s.ticker] = await getPrice(s.ticker);
            render(); // Renderiza cada vez que llega un precio nuevo
        }
    }

    function addStock() {
        const t = document.getElementById('new-tk').value.toUpperCase().trim();
        const q = parseFloat(document.getElementById('new-qty').value);
        if(t && q) {
            myStocks.push({ticker:t, qty:q});
            localStorage.setItem('myStocks', JSON.stringify(myStocks));
            updateStockPrices();
        }
    }

    function removeStock(i) {
        myStocks.splice(i, 1);
        localStorage.setItem('myStocks', JSON.stringify(myStocks));
        render();
    }

    function render() {
        let totalS = 0, totalM = 0, totalJ = 0;

        // RENDER ACCIONES
        document.getElementById('stocks-body').innerHTML = myStocks.map((s, i) => {
            const p = stockPrices[s.ticker] || 0;
            const sub = p * s.qty;
            totalS += sub;
            return `<tr><td><b>${s.ticker}</b></td><td>${s.qty}</td><td>${p ? '$'+p.toFixed(2) : '<span class="loading-text">Cargando...</span>'}</td><td class="subtotal">$${fmt(sub)}</td><td><button class="btn btn-del" onclick="removeStock(${i})">x</button></td></tr>`;
        }).join('');
        document.getElementById('sub-stocks').innerText = `Subtotal Acciones: $${fmt(totalS)}`;

        // RENDER MART√çN
        document.getElementById('martin-body').innerHTML = martinData.map(f => {
            const sub = f.p * f.q;
            totalM += sub;
            return `<tr><td>${f.n}<br><small>${f.c}</small></td><td>${f.q.toLocaleString('es-AR')}</td><td>$${f.p.toFixed(2)}</td><td class="subtotal">$${fmt(sub)}</td></tr>`;
        }).join('');
        document.getElementById('sub-martin').innerText = `Subtotal Mart√≠n: $${fmt(totalM)}`;

        // RENDER JORGE
        document.getElementById('jorge-body').innerHTML = jorgeData.map(f => {
            const sub = f.p * f.q;
            totalJ += sub;
            return `<tr><td>${f.n}<br><small>${f.c}</small></td><td>${f.q.toLocaleString('es-AR')}</td><td>$${f.p.toFixed(2)}</td><td class="subtotal">$${fmt(sub)}</td></tr>`;
        }).join('');
        document.getElementById('sub-jorge').innerText = `Subtotal Jorge: $${fmt(totalJ)}`;

        document.getElementById('total-general').innerText = `$${fmt(totalS + totalM + totalJ)}`;
    }

    // Iniciar
    render();
    updateStockPrices();
</script>
</body>
</html>
