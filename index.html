<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inversiones - Dashboard Familiar</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f4f7; color: #333; padding: 20px; }
        .container { max-width: 950px; margin: auto; }
        .header { background: #2c3e50; color: white; padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 25px; }
        h2 { border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; color: #2c3e50; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: #95a5a6; font-size: 11px; padding: 10px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 14px; }
        input { width: 90px; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
        .price { font-weight: bold; }
        .subtotal { font-weight: bold; color: #27ae60; text-align: right; }
        .fci-code { font-size: 11px; color: #7f8c8d; display: block; }
        .section-total { text-align: right; font-weight: bold; padding-top: 15px; border-top: 2px solid #eee; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <small>PATRIMONIO TOTAL CONSOLIDADO</small>
        <h1 id="total-general">$0.00</h1>
    </div>

    <div class="card">
        <h2>üìà Acciones & Crypto (En vivo)</h2>
        <table>
            <thead>
                <tr>
                    <th>Activo</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th style="text-align: right;">Subtotal</th>
                </tr>
            </thead>
            <tbody id="stocks-body"></tbody>
        </table>
    </div>

    <div class="card" style="border-left: 5px solid #e67e22;">
        <h2>üè¶ Fondos Comunes - Mart√≠n</h2>
        <table>
            <thead>
                <tr>
                    <th>Fondo</th>
                    <th>Cantidad</th>
                    <th>Precio (NAV)</th>
                    <th style="text-align: right;">Subtotal</th>
                </tr>
            </thead>
            <tbody id="martin-funds-body"></tbody>
        </table>
        <div class="section-total" id="total-martin">Total Mart√≠n: $0.00</div>
    </div>

    <div class="card" style="border-left: 5px solid #3498db;">
        <h2>üè¶ Fondos Comunes - Jorge</h2>
        <table>
            <thead>
                <tr>
                    <th>Fondo</th>
                    <th>Cantidad</th>
                    <th>Precio (NAV)</th>
                    <th style="text-align: right;">Subtotal</th>
                </tr>
            </thead>
            <tbody id="jorge-funds-body"></tbody>
        </table>
        <div class="section-total" id="total-jorge">Total Jorge: $0.00</div>
    </div>
</div>

<script>
    // 1. Acciones (Tickers de Yahoo)
    const myStocks = [
        { ticker: 'ASTS', qty: 100 },
        { ticker: 'IREN', qty: 50 },
        { ticker: 'PLTR', qty: 30 },
        { ticker: 'BTC-USD', qty: 0.05 }
    ];

    // 2. Fondos de Mart√≠n (Datos de la nueva captura)
    const martinFunds = [
        { name: "Fed. Hermes Short Term", code: "FORS", qty: 4713.21, initPrice: 1.00 },
        { name: "Lord Abbett Short Duration", code: "G5648E661", qty: 2582.186, initPrice: 12.57 },
        { name: "Janus Henderson Balanced", code: "G5S1BZ639", qty: 1727.545, initPrice: 20.80 },
        { name: "Pimco Global Bond", code: "G70974491", qty: 808.112, initPrice: 32.15 },
        { name: "Thornburg Global Equity", code: "G8T49N198", qty: 1157.025, initPrice: 36.41 },
        { name: "Allianz Income and Growth", code: "L016D6246", qty: 1421.231, initPrice: 17.6878 },
        { name: "Ab Sicav I US Equity", code: "L0173W230", qty: 620.444, initPrice: 68.29 },
        { name: "Franklin U.S. Opp.", code: "L4058Y329", qty: 357.654, initPrice: 55.32 },
        { name: "Franklin Global Conv.", code: "L40598481", qty: 2128.218, initPrice: 18.13 },
        { name: "Mfs Meridian Prudent", code: "L6366X224", qty: 3353.097, initPrice: 14.69 },
        { name: "Morgan Stanley Global Opp.", code: "L65228550", qty: 131.543, initPrice: 149.63 }
    ];

    // 3. Fondos de Jorge (Datos previos)
    const jorgeFunds = [
        { name: "Federated Hermes", code: "FORS", qty: 3819.89 },
        { name: "Janus Henderson", code: "G5S1BZ639", qty: 5034.388 },
        { name: "Allianz Income", code: "L016D6246", qty: 6315.422 },
        { name: "Franklin Global", code: "L40598481", qty: 7418.468 },
        { name: "MFS Meridian", code: "L6366X224", qty: 9179.767 },
        { name: "Morgan Stanley", code: "L65228550", qty: 267.019 }
    ];

    // Cargar precios guardados
    let martinPrices = JSON.parse(localStorage.getItem('martinPrices')) || {};
    let jorgePrices = JSON.parse(localStorage.getItem('jorgePrices')) || {};
    let stockData = {};

    async function getYahooPrice(ticker) {
        try {
            const proxy = "https://corsproxy.io/?";
            const url = encodeURIComponent(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}`);
            const response = await fetch(proxy + url);
            const data = await response.json();
            return data.chart.result[0].meta.regularMarketPrice;
        } catch (e) { return 0; }
    }

    async function updateAll() {
        // Actualizar Stocks
        const stockPromises = myStocks.map(async (s) => {
            const price = await getYahooPrice(s.ticker);
            stockData[s.ticker] = price;
            return price * s.qty;
        });
        const subtotalesS = await Promise.all(stockPromises);
        const totalStocks = subtotalesS.reduce((a, b) => a + b, 0);

        render(totalStocks);
    }

    function render(totalStocks) {
        // Render Stocks
        document.getElementById('stocks-body').innerHTML = myStocks.map(s => {
            const price = stockData[s.ticker] || 0;
            const sub = price * s.qty;
            return `<tr><td><strong>${s.ticker}</strong></td><td>${s.qty}</td><td class="price">$${price.toFixed(2)}</td><td class="subtotal">$${sub.toLocaleString()}</td></tr>`;
        }).join('');

        // Render Mart√≠n
        let totalM = 0;
        document.getElementById('martin-funds-body').innerHTML = martinFunds.map(f => {
            const price = martinPrices[f.code] || f.initPrice || 0;
            const sub = price * f.qty;
            totalM += sub;
            return `<tr>
                <td><strong>${f.name}</strong><span class="fci-code">${f.code}</span></td>
                <td>${f.qty.toLocaleString()}</td>
                <td><input type="number" step="0.0001" value="${price}" onchange="savePrice('martin', '${f.code}', this.value)"></td>
                <td class="subtotal">$${sub.toLocaleString()}</td>
            </tr>`;
        }).join('');
        document.getElementById('total-martin').innerText = `Total Mart√≠n: $${totalM.toLocaleString('es-AR')}`;

        // Render Jorge
        let totalJ = 0;
        document.getElementById('jorge-funds-body').innerHTML = jorgeFunds.map(f => {
            const price = jorgePrices[f.code] || 0;
            const sub = price * f.qty;
            totalJ += sub;
            return `<tr>
                <td><strong>${f.name}</strong><span class="fci-code">${f.code}</span></td>
                <td>${f.qty.toLocaleString()}</td>
                <td><input type="number" step="0.0001" value="${price}" onchange="savePrice('jorge', '${f.code}', this.value)"></td>
                <td class="subtotal">$${sub.toLocaleString()}</td>
            </tr>`;
        }).join('');
        document.getElementById('total-jorge').innerText = `Total Jorge: $${totalJ.toLocaleString('es-AR')}`;

        const grandTotal = totalStocks + totalM + totalJ;
        document.getElementById('total-general').innerText = `$${grandTotal.toLocaleString('es-AR', {minimumFractionDigits: 2})}`;
    }

    function savePrice(section, code, val) {
        const value = parseFloat(val) || 0;
        if(section === 'martin') {
            martinPrices[code] = value;
            localStorage.setItem('martinPrices', JSON.stringify(martinPrices));
        } else {
            jorgePrices[code] = value;
            localStorage.setItem('jorgePrices', JSON.stringify(jorgePrices));
        }
        updateAll();
    }

    updateAll();
    setInterval(updateAll, 300000);
</script>
</body>
</html>
